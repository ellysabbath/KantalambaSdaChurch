{% extends 'index.html' %}

{% block title %}Kantalamba SDA Church User Dashboard{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 transition-all duration-300">
    <div :class="{'text-white': dark, 'text-black': !dark}" class="transition-colors duration-300">

        <h2 class="text-3xl font-semibold text-gray-800 dark:text-white mb-8 text-center">Update Your Information</h2>

        <form id="updateForm" class="space-y-6" novalidate>
            {% csrf_token %}

            <!-- First Name and Middle Name -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="validationCustom01" class="block text-sm font-medium text-gray-700 dark:text-gray-300">First Name</label>
                    <input type="text" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationCustom01" name="first_name" required>
                </div>
                <div>
                    <label for="validationCustomMiddleName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Middle Name</label>
                    <input type="text" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationCustomMiddleName" name="middle_name" required>
                </div>
            </div>
            
            <!-- Last Name and Email -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="validationCustom02" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Last Name</label>
                    <input type="text" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationCustom02" name="last_name" required>
                </div>
                <div>
                    <label for="validationEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                    <input type="email" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationEmail" name="email" placeholder="eg: someone@gmail.com" required>
                </div>
            </div>

            <!-- Phone and Username -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="validationPhone" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Mobile Number</label>
                    <input type="number" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationPhone" name="phone_number" placeholder="eg: +255..." required>
                </div>
                <div>
                    <label for="validationCustomUsername" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label>
                    <input type="text" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationCustomUsername" name="username" required>
                </div>
            </div>

            <!-- Date of Birth and City -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="validationDOB" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date of Birth</label>
                    <input type="date" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationDOB" name="date_of_birth" required>
                </div>
                <div>
                    <label for="validationCity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">City</label>
                    <input type="text" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationCity" name="city" required>
                </div>
            </div>

            <!-- Church and Baptism Status -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="validationChurch" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Church</label>
                    <select class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationChurch" name="church" required>
                        <option selected disabled value="">Choose...</option>
                        <option value="iyumbu">Iyumbu</option>
                        <option value="ntyuka">Ntyuka</option>
                        <option value="Social">social</option>
                        <option value="makulu">makulu</option>
                        <option value="ngongona">Ngongona</option>
                        <option value="msangalalee">Msangalalee</option>
                    </select>
                </div>
                <div>
                    <label for="validationBaptismStatus" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Baptism Status</label>
                    <select class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationBaptismStatus" name="baptism_status" required>
                        <option selected disabled value="">Choose...</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
            </div>

            <!-- Gender -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Gender</label>
                <div class="flex items-center space-x-6">
                    <div class="flex items-center">
                        <input class="form-radio text-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="radio" name="gender" id="genderMale" value="male" required>
                        <label for="genderMale" class="ml-2 text-gray-700 dark:text-gray-300">Male</label>
                    </div>
                    <div class="flex items-center">
                        <input class="form-radio text-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="radio" name="gender" id="genderFemale" value="female" required>
                        <label for="genderFemale" class="ml-2 text-gray-700 dark:text-gray-300">Female</label>
                    </div>
                </div>
            </div>

            <!-- Password and Confirm Password -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="validationPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                    <input type="password" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationPassword" name="password" required>
                </div>
                <div>
                    <label for="validationConfirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Confirm Password</label>
                    <input type="password" class="mt-2 block w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="validationConfirmPassword" name="confirm_password" required>
                </div>
            </div>

            <!-- Terms Agreement -->
            <div>
                <div class="flex items-center">
                    <input class="form-checkbox text-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="checkbox" id="invalidCheck" name="terms_agreement" required>
                    <label for="invalidCheck" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Agree to terms and conditions</label>
                </div>
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit" class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none dark:bg-blue-600 dark:hover:bg-blue-700">
                    Update Information
                </button>
            </div>
            <br>
            <div :class="{'text-white': dark, 'text-black': !dark}" class="transition-colors duration-300">
                <a href="{% url 'createProfile' %}">
                <p>haven't profile yet?   create</p>
            </a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById('updateForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const formData = new FormData(this);
        const data = {
            first_name: formData.get('first_name'),
            middle_name: formData.get('middle_name'),
            last_name: formData.get('last_name'),
            email: formData.get('email'),
            phone_number: formData.get('phone_number'),
            username: formData.get('username'),
            date_of_birth: formData.get('date_of_birth'),
            city: formData.get('city'),
            church: formData.get('church'),
            baptism_status: formData.get('baptism_status'),
            gender: formData.get('gender'),
            password: formData.get('password'),
            confirm_password: formData.get('confirm_password'),
            terms_agreement: formData.get('terms_agreement') === 'on',
        };

        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch('/api/registrations/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken,
            },
            body: JSON.stringify(data),
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => { throw err; });
            }
            return response.json();
        })
        .then(data => {
            Swal.fire({
                icon: 'success',
                title: 'Registration Successful!',
                text: 'You have successfully created your profile.',
                confirmButtonText: 'Continue',
            }).then(() => {
                // Optional: redirect after registration
                window.location.href = '/signin/';
            });
        })
        .catch((error) => {
            let errorMsg = 'There was an issue registering. Please try again.';
            if (error && error.detail) {
                errorMsg = error.detail;
            }

            Swal.fire({
                icon: 'error',
                title: 'Registration Failed',
                text: errorMsg,
                confirmButtonText: 'OK',
            });
        });
    });
</script>


{% endblock %}
